{% extends 'base.html' %}

{% block title %}Application Status - {{ application.reference_number }}{% endblock %}

{% block content %}
<section class="status-section">
    <div class="status-container">
        <div class="status-card" data-aos="fade-up" data-aos-duration="600">
            <div class="status-header">
                <div class="status-icon status-{{ application.status }}">
                    <i class="fas {% if application.status == 'completed' %}fa-check-circle{% elif application.status == 'approved' %}fa-thumbs-up{% elif application.status == 'rejected' %}fa-times-circle{% elif application.status == 'under_review' %}fa-search{% else %}fa-clock{% endif %}"></i>
                </div>
                <h1>Application Status</h1>
                <p class="reference-number">{{ application.reference_number }}</p>
            </div>
            
            <div class="status-timeline">
                <div class="timeline-item {% if application.status in ['pending', 'under_review', 'approved', 'completed'] %}completed{% endif %}">
                    <div class="timeline-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="timeline-content">
                        <h4>Application Submitted</h4>
                        <p>{{ application.submitted_at.strftime('%Y-%m-%d %H:%M') }}</p>
                    </div>
                </div>
                
                <div class="timeline-item {% if application.status in ['under_review', 'approved', 'completed'] %}completed{% endif %}">
                    <div class="timeline-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="timeline-content">
                        <h4>Under Review</h4>
                        <p>Our team is reviewing your application</p>
                    </div>
                </div>
                
                <div class="timeline-item {% if application.status in ['approved', 'completed'] %}completed{% endif %}">
                    <div class="timeline-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="timeline-content">
                        <h4>Site Survey</h4>
                        <p>Technical assessment of your property</p>
                    </div>
                </div>
                
                <div class="timeline-item {% if application.status == 'completed' %}completed{% endif %}">
                    <div class="timeline-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="timeline-content">
                        <h4>Installation</h4>
                        <p>Solar system installation and grid connection</p>
                    </div>
                </div>
            </div>
            
            <div class="status-details">
                <div class="details-grid">
                    <div class="detail-card">
                        <h4><i class="fas fa-exchange-alt"></i> Application Type</h4>
                        <p>{% if application.application_type == 'simple_solar' %}Simple Solar Setup{% else %}{{ application.application_type|title }} Metering{% endif %}</p>
                    </div>
                    
                    <div class="detail-card">
                        <h4><i class="fas fa-bolt"></i> System Capacity</h4>
                        <p>{{ application.system_capacity }} kW</p>
                    </div>
                    
                    <div class="detail-card">
                        <h4><i class="fas fa-building"></i> Property Type</h4>
                        <p>{{ application.property_type|title if application.property_type else 'Not specified' }}</p>
                    </div>
                    
                    <div class="detail-card">
                        <h4><i class="fas fa-chart-bar"></i> Monthly Units</h4>
                        <p>{{ application.consumption_units or 'Not provided' }}</p>
                    </div>
                </div>
                
                <div class="detail-card full-width">
                    <h4><i class="fas fa-map-marker-alt"></i> Property Address</h4>
                    <p>{{ application.property_address }}</p>
                </div>
                
                {% if application.estimated_cost %}
                <div class="detail-card full-width">
                    <h4><i class="fas fa-money-bill-wave"></i> Estimated Cost</h4>
                    <p class="estimated-cost">PKR {{ "{:,.0f}".format(application.estimated_cost) }}</p>
                </div>
                {% endif %}
                
                {% if application.admin_notes %}
                <div class="detail-card full-width admin-notes">
                    <h4><i class="fas fa-comment"></i> Admin Notes</h4>
                    <p>{{ application.admin_notes }}</p>
                </div>
                {% endif %}
                
                {% if application.documents %}
                {% set docs = application.docs_dict %}
                {% if docs %}
                <div class="detail-card full-width">
                    <h4><i class="fas fa-file-alt"></i> Uploaded Documents</h4>
                    <div style="display:flex;flex-wrap:wrap;gap:0.75rem;margin-top:0.5rem">
                        {% for doc_type, doc_path in docs.items() %}
                        <a href="{{ url_for('static', filename='images/' + doc_path) }}" target="_blank" 
                           style="display:inline-flex;align-items:center;gap:0.4rem;padding:0.4rem 0.8rem;background:var(--bg-secondary);border-radius:0.5rem;text-decoration:none;color:var(--primary-color);font-size:0.85rem;font-weight:500;border:1px solid var(--border-color)">
                            <i class="fas fa-file-image"></i> {{ doc_type|replace('_', ' ')|title }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                {% endif %}
            </div>
            
            <div class="status-actions">
                <a href="{{ url_for('client_dashboard') }}" class="btn btn-primary">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
                <a href="{{ url_for('index') }}" class="btn btn-outline">
                    <i class="fas fa-home"></i> Go to Home
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}
